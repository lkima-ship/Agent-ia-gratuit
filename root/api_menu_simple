cat > /root/api_menu.py << 'EOF'
#!/usr/bin/env python3
"""
Menu API simple - Commandes faciles 1-2-3
"""
import os
import sys
import subprocess
import time

def clear_screen():
    """Efface l'Ã©cran"""
    os.system('clear' if os.name == 'posix' else 'cls')

def check_api():
    """VÃ©rifie si l'API est en cours d'exÃ©cution"""
    try:
        result = subprocess.run(
            ['curl', '-s', '--max-time', '2', 'http://localhost:5000'],
            capture_output=True,
            text=True
        )
        return result.returncode == 0
    except:
        return False

def start_api():
    """DÃ©marre l'API"""
    print("1ï¸âƒ£  DÃ©marrage de l'API...")
    
    # ArrÃªte d'abord si dÃ©jÃ  en cours
    subprocess.run(['pkill', '-f', 'simple_api.py'], 
                   stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
    time.sleep(1)
    
    # DÃ©marre l'API
    result = subprocess.Popen(
        ['cd', '/root', '&&', 'python3', 'simple_api.py', '&'],
        shell=True,
        stdout=subprocess.DEVNULL,
        stderr=subprocess.DEVNULL
    )
    
    print("â³ Veuillez patienter 3 secondes...")
    time.sleep(3)
    
    if check_api():
        print("âœ… API dÃ©marrÃ©e avec succÃ¨s!")
        print("ðŸŒ Adresse: http://localhost:5000")
    else:
        print("âŒ Ã‰chec du dÃ©marrage de l'API")
    
    input("\nâŽ Appuyez sur EntrÃ©e pour continuer...")

def stop_api():
    """ArrÃªte l'API"""
    print("2ï¸âƒ£  ArrÃªt de l'API...")
    subprocess.run(['pkill', '-f', 'simple_api.py'], 
                   stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
    print("âœ… API arrÃªtÃ©e")
    time.sleep(1)
    input("\nâŽ Appuyez sur EntrÃ©e pour continuer...")

def test_api():
    """Teste l'API"""
    print("3ï¸âƒ£  Test de l'API...")
    
    if check_api():
        print("ðŸŸ¢ API connectÃ©e!")
        
        # Affiche la rÃ©ponse
        result = subprocess.run(
            ['curl', '-s', 'http://localhost:5000'],
            capture_output=True,
            text=True
        )
        print(f"ðŸ“¦ RÃ©ponse: {result.stdout[:100]}...")
        
        # Test des agents
        result = subprocess.run(
            ['curl', '-s', 'http://localhost:5000/agents'],
            capture_output=True,
            text=True
        )
        print(f"ðŸ¤– Agents: {result.stdout[:100]}...")
    else:
        print("ðŸ”´ API non connectÃ©e")
    
    input("\nâŽ Appuyez sur EntrÃ©e pour continuer...")

def main_menu():
    """Menu principal"""
    while True:
        clear_screen()
        
        print("=" * 50)
        print("ðŸš€ MENU API - Commandes simples 1-2-3")
        print("=" * 50)
        
        # Statut de l'API
        api_status = "ðŸŸ¢ EN COURS" if check_api() else "ðŸ”´ ARRÃŠTÃ‰E"
        print(f"\nðŸ“Š Statut actuel: {api_status}")
        
        print("\n" + "=" * 50)
        print("1ï¸âƒ£  DÃ‰MARRER l'API")
        print("2ï¸âƒ£  ARRÃŠTER l'API")
        print("3ï¸âƒ£  TESTER l'API")
        print("4ï¸âƒ£  AFFICHER l'URL")
        print("5ï¸âƒ£  MENU AGENTS")
        print("0ï¸âƒ£  QUITTER")
        print("=" * 50)
        
        choix = input("\nðŸ‘‰ Votre choix (0-5): ").strip()
        
        if choix == "1":
            start_api()
        elif choix == "2":
            stop_api()
        elif choix == "3":
            test_api()
        elif choix == "4":
            print("\nðŸŒ URL de l'API: http://localhost:5000")
            print("ðŸ“ Endpoints:")
            print("  - http://localhost:5000/")
            print("  - http://localhost:5000/agents")
            input("\nâŽ Appuyez sur EntrÃ©e pour continuer...")
        elif choix == "5":
            # Ouvre le menu des agents
            print("\nðŸ¤– Ouverture du menu des agents...")
            time.sleep(1)
            os.system('python3 /root/menu_avance.py')
        elif choix == "0":
            print("\nðŸ‘‹ Au revoir!")
            break
        else:
            print("âŒ Choix invalide!")
            time.sleep(1)

if __name__ == "__main__":
    # VÃ©rifie que simple_api.py existe
    if not os.path.exists("/root/simple_api.py"):
        print("âŒ Fichier simple_api.py non trouvÃ©!")
        print("ðŸ“ CrÃ©ation du fichier API...")
        
        # CrÃ©e le fichier API
        with open("/root/simple_api.py", "w") as f:
            f.write("""#!/usr/bin/env python3
from flask import Flask, jsonify
import os

app = Flask(__name__)

@app.route('/')
def hello():
    return jsonify({
        "message": "API Flask en ligne!",
        "status": "OK",
        "port": 5000
    })

@app.route('/agents')
def agents():
    import glob
    agents_list = [f for f in glob.glob("*.py") if 'menu' not in f]
    return jsonify({"agents": agents_list})

if __name__ == '__main__':
    print("ðŸš€ API Flask dÃ©marre sur http://localhost:5000")
    app.run(host='0.0.0.0', port=5000, debug=False)
""")
        
        print("âœ… Fichier API crÃ©Ã©!")
        time.sleep(2)
    
    # VÃ©rifie Flask
    try:
        import flask
    except ImportError:
        print("ðŸ“¦ Installation de Flask...")
        os.system("pip3 install flask 2>/dev/null || pip install flask 2>/dev/null")
    
    # Lance le menu
    main_menu()
EOF
